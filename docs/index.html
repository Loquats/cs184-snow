<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<style>
  body {
    padding: 100px;
    width: 1000px;
    margin: auto;
    text-align: left;
    font-weight: 300;
    font-family: 'Open Sans', sans-serif;
    color: #121212;
  }
  h1, h2, h3, h4 {
    font-family: 'Source Sans Pro', sans-serif;
  }
  h2 {
    margin-top:5px;
    margin-bottom:5px;
  }
    img {
        width: 500px;
    }
    .narrow {
        width: 300px;
    }
</style>
<title>Snow Simulation</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
</head>

<body>

<h1 align="middle">Snow Simulation Final Project</h1>
<h1 align="middle">CS 184: Computer Graphics and Imaging, Spring 2018</h1>
<h2 align="middle">Yue (Andy) Zhang, cs184-acv, SID: 25116308</h2>
<h2 align="middle">Brandon Huang, cs184-afi, SID: 25523652</h2>
<h2 align="middle">Ankit Patel, cs184-agy, SID: 25249884</h2>

<br>
  <h2 align="middle">Abstract</h2>
  <p>
    We implement 3D snow simulation using the material point method (MPM) and a renderer in OpenGL. Snow is extremely challenging to simulate because it has material characteristics of both liquids and solids. The MPM simulation approach is implemented based on a 2013 paper by Stomakhin et al., and offers a reasonable runtime and control over some intuitive properties of the material. We show that plausible results can be obtained even with relatively coarse particle and grid resolution, and replicate some of the demonstrations from the original paper. We also implement basic 3D rendering of snow scenes, and iteratively implemented optimizations to improve simulation runtime.
  </p>

  <h2 align="middle">Technical Approach</h2>
  <div align="center">
    <img src="resources/mpm-overview.png"/>
    <figcaption>Overview of MPM. Particle mass and velocity are interpolated onto a grid, where most physics computations occur. The velocities at the next time step are interpolated back onto the particles.</figcaption>
  </div>
  <p>
    There are many ways to simulate snow, each with strengths and weaknesses. Mesh based methods have significant trouble modeling fracture, because of the need to explicitly define fracture of a contiguous solid. Pure grid based methods struggle with plasticity because deforming a grid results in a great deal of nonlinear computation. And particle-only methods suffer from inefficiency due to a high demand for nearest neighbor queries to compute dynamics. The material point method is a simulation method well-suited for continuum materials. MPM addresses these problems by using the grid as a "scratch-pad" for computations, while maintaining Lagrangian state as point particles with mass, volume, and velocity. MPM is mesh-free and avoids directly computing interactions between particles by interpolating particle properties onto a 3D grid, a computes physics on this grid.
  </p>

  <h3 align="middle">Physical Simulation</h3>
  <p>
    Our simulator defines as primitives snow particles and rectangular/planar interactable collision objects. Our implementation of MPM closely resembles the implementation provided in the paper. Here is an overview of our approach, numbered consistently with the diagram above:
  </p>
  <ol>
    <li> Interpolate particle states to the grid. We use a cubic b-spline to interpolate the mass and velocity of each particle onto the 3D grid. Each particle affects multiple grid cells, in its neighborhood. 
    <li> Compute the volume and density of each particle. This is done once in the entire simulation. The density of each grid cell is computed, and this is interpolated to particles using the same b-spline weights as part 1.
    <li> Compute grid forces. Forces are first computed on each grid cell based on the elastic potential energy of particles in its neighborhood. 
    <li> Compute grid velocities. The velocity of each grid cell can be computed from its force. 
  </ol>

  <h3 align="middle">Rendering</h3>

  <h3 align="middle">Optimizations</h3>
  <p>
  - discretize and precompute scalar interpolation function
  - save b-spline neighborhood weights for each particle per simulation step
  - most grid cells are empty and not near any particles, so we only store grid cells that are actively being used, ie. within the neighborhood of a prticle
  - threading
  - compiler optimizations, by far one of the most effective
  </p>
  <h3 align="middle">Miscellaneous</h3>
  <p>
    Our implementation also provides a way to save simulations as videos. In addition to the live rendering, the program optionally saves the rendered frames into an .avi video file. This is especially useful for rendering at high grid resolution to improve physics accuracy, where each frame takes a few seconds or minutes to compute. 
  </p>
  <h3 align="middle">Problems</h3>
  <p>
    The biggest problem we encountered was runtime efficiency. Our initial implementation focused on getting everything to work, but was very inefficient, so after the initial implementation, we spent a lot of time rewriting the code for efficiency, as described in the "Optimization" section.
  </p>
  <p>
    Another major challenge was CMake, and integrating/compiling the various libraries we used. This was our first time working with CMake. Each library seemed to have a slightly different way of integrating, and given our limited experience, figuring it the integration involved much trial and error. 
  </p>
  <h3 align="middle">Lessons Learned</h3>

  <h2 align="middle">Results</h2>
  <p>
    We demonstrate some of the simuluation results in this section. Note that in all demonstration videos, there exist transparent walls on the four sides of the scene area, and snow particles will collide and stick to these walls, despite being transparent.
  </p>
  <p>
    There are four main physical parameters that control the material property of the snow, and by tuning these coefficents, we can create different types of snow. The hardening coefficient and Young's modulus determines how fast snow breaks apart, and controls whether the snow is brittle/icy or ductile/watery. The critical compression and critical stretch are two parameters that determine when snow breaks apart, and whether snow is chunky/wet or powdery/dry. 
  </p>
    <div align="middle">
      <table style="width=100%">
        <tr>
            <td>
                <iframe width="560" height="315" src="LINK HERE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <figcaption align="middle">Default</figcaption>
            </td>
            <td>
                <iframe width="560" height="315" src="LINK HERE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <figcaption align="middle">Low hardening</figcaption>
            </td>
        </tr>
        <tr>
            <td>
                <iframe width="560" height="315" src="LINK HERE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <figcaption align="middle">Low Young's modulus</figcaption>
            </td>
            <td>
                <iframe width="560" height="315" src="LINK HERE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <figcaption align="middle">Low critical compression</figcaption>
            </td>
        </tr>
        <tr>
            <td>
                <iframe width="560" height="315" src="LINK HERE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <figcaption align="middle">Low critical stretch</figcaption>
            </td>
            <td>
                <iframe width="560" height="315" src="LINK HERE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <figcaption align="middle">Low critical compression and stretch</figcaption>
            </td>
        </tr>
      </table>
    </div>
  <p>
    We'll also demonstrate how snow interacts with rigid objects. Here, a rigid cube "cannonball" hits a tower of snow at two different velocities.
  </p>
    <div align="middle">
      <table style="width=100%">
        <tr>
            <td>
                <iframe width="560" height="315" src="LINK HERE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <figcaption align="middle">Low velocity collision</figcaption>
            </td>
            <td>
                <iframe width="560" height="315" src="LINK HERE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <figcaption align="middle">High velocity collision</figcaption>
            </td>
        </tr>
      </table>
    </div>
  <p>
    Here is a "snowplow" throwing up snow.
  </p>
    <div align="middle">
      <table style="width=100%">
        <tr>
            <td>
                <iframe width="560" height="315" src="LINK HERE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <figcaption align="middle">Snowplow</figcaption>
            </td>
        </tr>
      </table>
    </div>
  <p>
    Here, a snowball crashes into the wall. Note that upon collision, a portion of the snowball fractures and falls off, while another portion sticks to the wall and falls off slowly.
  </p>
    <div align="middle">
      <table style="width=100%">
        <tr>
            <td>
                <iframe width="560" height="315" src="LINK HERE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                <figcaption align="middle">Snowplow</figcaption>
            </td>
        </tr>
      </table>
    </div>

  <h2 align="middle">Contribution Breakdown</h2>

  <h2 align="middle">References</h2>
  - snow paper
  - snow paper tech report
  - GLAD
  _ GLFW
  - GLM
  - Eigen
  - some threading library on github
  - Sifakis svd?
</body>
</html>
